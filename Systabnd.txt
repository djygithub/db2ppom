R0       EQU   0
R1       EQU   1
R2       EQU   2
R3       EQU   3
R4       EQU   4
R5       EQU   5
R6       EQU   6
R7       EQU   7
R8       EQU   8
R9       EQU   9
R10      EQU   10
R11      EQU   11
R12      EQU   12
R13      EQU   13
R14      EQU   14
R15      EQU   15
*
         DSNDIFCA  DSECT=YES
*
*
         DSNDQWST  DSECT=YES,SUBTYPE=ALL
*
$PARM1   DSECT
         DC    CL8'WORKAREA'
* QWSA AREA - CPU TIMERS FOR DSNDBM1, DSNMSTR, IRLM
QWSAPRC1 DS    CL4                   PROC NAME
QWSATCB1 DS    XL8                   TCB TIME
QWSASRB1 DS    XL8                   SRB TIME
QWSAAS#1 DS    H                     ASID
QWSAPRC2 DS    CL4                   PROC NAME
QWSATCB2 DS    XL8                   TCB TIME
QWSASRB2 DS    XL8                   SRB TIME
QWSAAS#2 DS    H                     ASID
QWSAPRC3 DS    CL4                   PROC NAME
QWSATCB3 DS    XL8                   TCB TIME
QWSASRB3 DS    XL8                   SRB TIME
QWSAAS#3 DS    H                     ASID
QWSAPRC4 DS    CL4                   PROC NAME
QWSATCB4 DS    XL8                   TCB TIME
QWSASRB4 DS    XL8                   SRB TIME
QWSAAS#4 DS    H                     ASID
* Q3ST AREA - SSI CALLS FROM ALLIED AGENTS
Q3ST#1   DS    F                     IDENTIFY REQUESTS
Q3ST#2   DS    F                     SIGN ON REQUESTS
Q3ST#3   DS    F                     CREATE THREAD REQUESTS
Q3ST#4   DS    F                     TERMINATE THREAD REQUESTS
Q3ST#5   DS    F                     RESOLVED IN-DOUBT U OF R
Q3ST#6   DS    F                     COMMIT PHASE 1
Q3ST#7   DS    F                     COMMIT PHASE 2
Q3ST#8   DS    F                     THREAD ABENDS
Q3ST#9   DS    F                     SINGLE PHASE COMMITS
Q3ST#10  DS    F                     IN-DOUBT U OF R
Q3ST#11  DS    F                     THREAD EOT
Q3ST#12  DS    F                     THREAD EOM
Q3ST#13  DS    F                     TOTAL SSI CALLS
Q3ST#14  DS    F                     # OF CREATE THREADS WHICH WAITED
Q3ST#15  DS    F                     # READ ONLY COMMITS
* Q9ST AREA - COMMAND COUNTERS
Q9ST#1   DS    F                     DISPLAY DATABASE
Q9ST#2   DS    F                     DISPLAY THREAD
Q9ST#3   DS    F                     DISPLAY UTILITY
Q9ST#4   DS    F                     RECOVER BSDS
Q9ST#5   DS    F                     RECOVER IN-DOUBT
Q9ST#6   DS    F                     START DATABASE
Q9ST#7   DS    F                     START TRACE
Q9ST#8   DS    F                     START SUB-SYSTEM
Q9ST#9   DS    F                     STOP DATABASE
Q9ST#10  DS    F                     STOP TRACE
Q9ST#11  DS    F                     STOP SUBSYSTEM
Q9ST#12  DS    F                     TERM UTILITY
Q9ST#13  DS    F                     DISPLAY TRACE
Q9ST#14  DS    F                     RESERVED
Q9ST#15  DS    F                     UNRECOGNIZED COMMAND
Q9ST#16  DS    F                     START RLIMIT
Q9ST#17  DS    F                     STOP RLIMIT
Q9ST#18  DS    F                     DISPLAY RLIMIT
Q9ST#19  DS    F                     MODIFY TRACE
Q9ST#20  DS    F                     START DDF
Q9ST#21  DS    F                     STOP DDF
Q9ST#22  DS    F                     CANCEL DDF THREAD
Q9ST#23  DS    F                     DISPLAY LOCATION
Q9ST#24  DS    F                     ARCHIVE LOG
Q9ST#25  DS    F                     ALTER BUFFERPOOL
Q9ST#26  DS    F                     DISPLAY  BUFFERPOOL
Q9ST#27  DS    F                     SET ARCHIVE
Q9ST#28  DS    F                     DISPLAY ARCHIVE
Q9ST#29  DS    F                     RESET INDOUBT
Q9ST#30  DS    F                     DISPLAY GBPOOL
Q9ST#31  DS    F                     DISPLAY PROCEDURE
Q9ST#32  DS    F                     START PROCEDURE
Q9ST#33  DS    F                     STOP PROCEDURE
Q9ST#34  DS    F                     DISPLAY GROUP
* QWSD AREA - CHECKPOINT COUNT A HIGH USED RBA
QWSD#1   DS    F                     CHECK POINT COUNT
QWSD#2   DS    CL16                  HIGH USED RBA ADDRESS OF LOG
QWSD#3   DS    F                     IFI ABENDS
QWSD#4   DS    F                     UNRECOGNIZED FUNCTION
QWSD#5   DS    F                     COMMANDS
QWSD#6   DS    F                     READA
QWSD#7   DS    F                     READS
QWSD#8   DS    F                     WRITE
QWSD#9   DS    F                     DC LOG RECORDS
QWSD#10  DS    F                     DC LOG READS
QWSD#11  DS    F                     DC LOG RECORDS RETURNED
QWSD#12  DS    F                     DATA ROWS
QWSD#13  DS    F                     DESCRIPTION
QWSD#14  DS    F                     DESCRIBES
QWSD#15  DS    F                     TABLES
* QJST AREA - LOG ACTIVITY
QJST#1   DS    F                     WRITE WAITS
QJST#2   DS    F                     WRITE NO WAITS
QJST#3   DS    F                     WRITE FORCE
QJST#4   DS    F                     WAIT DUE TO ACTIVE BUFFER
QJST#5   DS    F                     LOG READS FROM BUFFER
QJST#6   DS    F                     LOG READS FROM ACTIVE LOG
QJST#7   DS    F                     LOG READS FROM ARCHIVE LOG
QJST#8   DS    F                     READS DELAYED ALLOCATION LIMIT
QJST#9   DS    F                     BSDS ACCESS REQUESTS
QJST#10  DS    F                     ACTIVE LOG ARCHIVE CI'S
QJST#11  DS    F                     WRITE ACTIVE LOG BUFFERS
QJST#12  DS    F                     ARCHIVE LOG READ ALLOCATIONS
QJST#13  DS    F                     ARCHIVE LOG WRITE ALLOCATIONS
QJST#14  DS    F                     COUNT OF CONTROL INTERVALS
QJST#15  DS    F          READ DELAYS
QJST#16  DS    F          LOOK AHEAD TAPE MOUNT REQUESTS
QJST#17  DS    F          LOOK AHEAD TAPE MOUNTS DONE
TIMESTMP DS    XL8                   RECORD MOVEMENT TIMESTAMP
*
*  QLST DDF QWS00RA0
*
QLST1#1  DS    CL16       LOCATION
QLST1#2  DS    F          #SQL STATEMENTS SENT
QLST1#3  DS    F          #SQL STATEMENTS RECEIVED
QLST1#4  DS    F          #ROWS SENT
QLST1#5  DS    F          #ROWS RECEIVED
QLST1#6  DS    F          #BYTES SENT
QLST1#7  DS    F          #BYTES RECEIVED
QLST1#8  DS    F          #CONV INITIATED HERE
QLST1#9  DS    F          #CONV INITIATED THERE
QLST1#10 DS    F          #MESSAGES SENT
QLST1#11 DS    F          #MESSAGES RECEIVED
QLST1#12 DS    F          #DBAT ALLOCATIONS SENT
QLST1#13 DS    F          #DBAT ALLOCATIONS RECEIVED
QLST1#14 DS    F          #SINGLE PHASE COMMITS SENT
QLST1#15 DS    F          #SINGLE PHASE COMMITS RECEIVED
QLST1#16 DS    F          #SINGLE PHASE ABORTS SENT
QLST1#17 DS    F          #SINGLE PHASE ABORTS RECEIVED
QLST1#18 DS    F          #QUEUED CONVERSATION REQUESTS
QLST1#19 DS    F          #SWITCHES CONT BLOCK --> LIM BLOCK
QLST1#20 DS    F          #SQL STATEMENTS BOUND REMOTELY
QLST1#21 DS    F          #ROWS MSG BUFF BLOCK FETCH
QLST1#22 DS    F          #BLOCKS TRANSMITTED VIA BLOCK FETCH
QLST1#23 DS    F          #BLOCKS RECEIVED VIA BLOCK FETCH
QLST1#24 DS    F          #2 PHASE COMMIT PREPARES SENT
QLST1#25 DS    F          #2 PHASE COMMIT PREPARES RECEIVED
QLST1#26 DS    F          #2 PHASE COMMIT LAST AGENT SENT
QLST1#27 DS    F          #2 PHASE COMMIT LAST AGENT RECEIVED
QLST1#28 DS    F          #2 PHASE COMMIT COMMITS SENT
QLST1#29 DS    F          #2 PHASE COMMIT COMMITS RECEIVED
QLST1#30 DS    F          #2 PHASE COMMIT BACKOUTS SENT
QLST1#31 DS    F          #2 PHASE COMMIT BACKOUTS RECEIVED
QLST1#32 DS    F          #2 PHASE COMMIT FORGETS SENT
QLST1#33 DS    F          #2 PHASE COMMIT FORGETS RECEIVED
QLST1#34 DS    F          #2 PHASE COMMIT REQUEST COMMIT SENT
QLST1#35 DS    F          #2 PHASE COMMIT REQ COMMIT RECEIVED
QLST1#36 DS    F          #2 PHASE COMMIT BACKOUT RESPONSE SENT
QLST1#37 DS    F          #2 PHASE COMMIT BACKOUT RESPONSE RECEIVED
QLST1#38 DS    F          #INDOUBT THREADS VIA REMOTE
QLST1#39 DS    F          #COMMIT OPERATIONS VIA REMOTE
QLST1#40 DS    F          #ROLLBACK OPERATIONS VIA REMOTE
*
QLST2#1  DS    CL16       LOCATION
QLST2#2  DS    F          #SQL STATEMENTS SENT
QLST2#3  DS    F          #SQL STATEMENTS RECEIVED
QLST2#4  DS    F          #ROWS SENT
QLST2#5  DS    F          #ROWS RECEIVED
QLST2#6  DS    F          #BYTES SENT
QLST2#7  DS    F          #BYTES RECEIVED
QLST2#8  DS    F          #CONV INITIATED HERE
QLST2#9  DS    F          #CONV INITIATED THERE
QLST2#10 DS    F          #MESSAGES SENT
QLST2#11 DS    F          #MESSAGES RECEIVED
QLST2#12 DS    F          #DBAT ALLOCATIONS SENT
QLST2#13 DS    F          #DBAT ALLOCATIONS RECEIVED
QLST2#14 DS    F          #SINGLE PHASE COMMITS SENT
QLST2#15 DS    F          #SINGLE PHASE COMMITS RECEIVED
QLST2#16 DS    F          #SINGLE PHASE ABORTS SENT
QLST2#17 DS    F          #SINGLE PHASE ABORTS RECEIVED
QLST2#18 DS    F          #QUEUED CONVERSATION REQUESTS
QLST2#19 DS    F          #SWITCHES CONT BLOCK --> LIM BLOCK
QLST2#20 DS    F          #SQL STATEMENTS BOUND REMOTELY
QLST2#21 DS    F          #ROWS MSG BUFF BLOCK FETCH
QLST2#22 DS    F          #BLOCKS TRANSMITTED VIA BLOCK FETCH
QLST2#23 DS    F          #BLOCKS RECEIVED VIA BLOCK FETCH
QLST2#24 DS    F          #2 PHASE COMMIT PREPARES SENT
QLST2#25 DS    F          #2 PHASE COMMIT PREPARES RECEIVED
QLST2#26 DS    F          #2 PHASE COMMIT LAST AGENT SENT
QLST2#27 DS    F          #2 PHASE COMMIT LAST AGENT RECEIVED
QLST2#28 DS    F          #2 PHASE COMMIT COMMITS SENT
QLST2#29 DS    F          #2 PHASE COMMIT COMMITS RECEIVED
QLST2#30 DS    F          #2 PHASE COMMIT BACKOUTS SENT
QLST2#31 DS    F          #2 PHASE COMMIT BACKOUTS RECEIVED
QLST2#32 DS    F          #2 PHASE COMMIT FORGETS SENT
QLST2#33 DS    F          #2 PHASE COMMIT FORGETS RECEIVED
QLST2#34 DS    F          #2 PHASE COMMIT REQUEST COMMIT SENT
QLST2#35 DS    F          #2 PHASE COMMIT REQ COMMIT RECEIVED
QLST2#36 DS    F          #2 PHASE COMMIT BACKOUT RESPONSE SENT
QLST2#37 DS    F          #2 PHASE COMMIT BACKOUT RESPONSE RECEIVED
QLST2#38 DS    F          #INDOUBT THREADS VIA REMOTE
QLST2#39 DS    F          #COMMIT OPERATIONS VIA REMOTE
QLST2#40 DS    F          #ROLLBACK OPERATIONS VIA REMOTE
*
QLST3#1  DS    CL16       LOCATION
QLST3#2  DS    F          #SQL STATEMENTS SENT
QLST3#3  DS    F          #SQL STATEMENTS RECEIVED
QLST3#4  DS    F          #ROWS SENT
QLST3#5  DS    F          #ROWS RECEIVED
QLST3#6  DS    F          #BYTES SENT
QLST3#7  DS    F          #BYTES RECEIVED
QLST3#8  DS    F          #CONV INITIATED HERE
QLST3#9  DS    F          #CONV INITIATED THERE
QLST3#10 DS    F          #MESSAGES SENT
QLST3#11 DS    F          #MESSAGES RECEIVED
QLST3#12 DS    F          #DBAT ALLOCATIONS SENT
QLST3#13 DS    F          #DBAT ALLOCATIONS RECEIVED
QLST3#14 DS    F          #SINGLE PHASE COMMITS SENT
QLST3#15 DS    F          #SINGLE PHASE COMMITS RECEIVED
QLST3#16 DS    F          #SINGLE PHASE ABORTS SENT
QLST3#17 DS    F          #SINGLE PHASE ABORTS RECEIVED
QLST3#18 DS    F          #QUEUED CONVERSATION REQUESTS
QLST3#19 DS    F          #SWITCHES CONT BLOCK --> LIM BLOCK
QLST3#20 DS    F          #SQL STATEMENTS BOUND REMOTELY
QLST3#21 DS    F          #ROWS MSG BUFF BLOCK FETCH
QLST3#22 DS    F          #BLOCKS TRANSMITTED VIA BLOCK FETCH
QLST3#23 DS    F          #BLOCKS RECEIVED VIA BLOCK FETCH
QLST3#24 DS    F          #2 PHASE COMMIT PREPARES SENT
QLST3#25 DS    F          #2 PHASE COMMIT PREPARES RECEIVED
QLST3#26 DS    F          #2 PHASE COMMIT LAST AGENT SENT
QLST3#27 DS    F          #2 PHASE COMMIT LAST AGENT RECEIVED
QLST3#28 DS    F          #2 PHASE COMMIT COMMITS SENT
QLST3#29 DS    F          #2 PHASE COMMIT COMMITS RECEIVED
QLST3#30 DS    F          #2 PHASE COMMIT BACKOUTS SENT
QLST3#31 DS    F          #2 PHASE COMMIT BACKOUTS RECEIVED
QLST3#32 DS    F          #2 PHASE COMMIT FORGETS SENT
QLST3#33 DS    F          #2 PHASE COMMIT FORGETS RECEIVED
QLST3#34 DS    F          #2 PHASE COMMIT REQUEST COMMIT SENT
QLST3#35 DS    F          #2 PHASE COMMIT REQ COMMIT RECEIVED
QLST3#36 DS    F          #2 PHASE COMMIT BACKOUT RESPONSE SENT
QLST3#37 DS    F          #2 PHASE COMMIT BACKOUT RESPONSE RECEIVED
QLST3#38 DS    F          #INDOUBT THREADS VIA REMOTE
QLST3#39 DS    F          #COMMIT OPERATIONS VIA REMOTE
QLST3#40 DS    F          #ROLLBACK OPERATIONS VIA REMOTE
*
QLST4#1  DS    CL16       LOCATION
QLST4#2  DS    F          #SQL STATEMENTS SENT
QLST4#3  DS    F          #SQL STATEMENTS RECEIVED
QLST4#4  DS    F          #ROWS SENT
QLST4#5  DS    F          #ROWS RECEIVED
QLST4#6  DS    F          #BYTES SENT
QLST4#7  DS    F          #BYTES RECEIVED
QLST4#8  DS    F          #CONV INITIATED HERE
QLST4#9  DS    F          #CONV INITIATED THERE
QLST4#10 DS    F          #MESSAGES SENT
QLST4#11 DS    F          #MESSAGES RECEIVED
QLST4#12 DS    F          #DBAT ALLOCATIONS SENT
QLST4#13 DS    F          #DBAT ALLOCATIONS RECEIVED
QLST4#14 DS    F          #SINGLE PHASE COMMITS SENT
QLST4#15 DS    F          #SINGLE PHASE COMMITS RECEIVED
QLST4#16 DS    F          #SINGLE PHASE ABORTS SENT
QLST4#17 DS    F          #SINGLE PHASE ABORTS RECEIVED
QLST4#18 DS    F          #QUEUED CONVERSATION REQUESTS
QLST4#19 DS    F          #SWITCHES CONT BLOCK --> LIM BLOCK
QLST4#20 DS    F          #SQL STATEMENTS BOUND REMOTELY
QLST4#21 DS    F          #ROWS MSG BUFF BLOCK FETCH
QLST4#22 DS    F          #BLOCKS TRANSMITTED VIA BLOCK FETCH
QLST4#23 DS    F          #BLOCKS RECEIVED VIA BLOCK FETCH
QLST4#24 DS    F          #2 PHASE COMMIT PREPARES SENT
QLST4#25 DS    F          #2 PHASE COMMIT PREPARES RECEIVED
QLST4#26 DS    F          #2 PHASE COMMIT LAST AGENT SENT
QLST4#27 DS    F          #2 PHASE COMMIT LAST AGENT RECEIVED
QLST4#28 DS    F          #2 PHASE COMMIT COMMITS SENT
QLST4#29 DS    F          #2 PHASE COMMIT COMMITS RECEIVED
QLST4#30 DS    F          #2 PHASE COMMIT BACKOUTS SENT
QLST4#31 DS    F          #2 PHASE COMMIT BACKOUTS RECEIVED
QLST4#32 DS    F          #2 PHASE COMMIT FORGETS SENT
QLST4#33 DS    F          #2 PHASE COMMIT FORGETS RECEIVED
QLST4#34 DS    F          #2 PHASE COMMIT REQUEST COMMIT SENT
QLST4#35 DS    F          #2 PHASE COMMIT REQ COMMIT RECEIVED
QLST4#36 DS    F          #2 PHASE COMMIT BACKOUT RESPONSE SENT
QLST4#37 DS    F          #2 PHASE COMMIT BACKOUT RESPONSE RECEIVED
QLST4#38 DS    F          #INDOUBT THREADS VIA REMOTE
QLST4#39 DS    F          #COMMIT OPERATIONS VIA REMOTE
QLST4#40 DS    F          #ROLLBACK OPERATIONS VIA REMOTE
*
* QDST DDF QWS00RCO
*
QDST#1   DS    F          #QUEUED DBAT MAX REMOTE THREADS
QDST#2   DS    F          #2 PHASE COMMIT COLD STARTS
QDST#3   DS    F          #2 PHASE COMMITS WARM STARTS
QDST#4   DS    F          #2 PHASE COMMIT RESYNCH ATTEMPTS
QDST#5   DS    F          #2 PHASE COMMIT RESYNCH SUCCESSES
QDST#6   DS    F          #CONVERSATION DEALLOCATED ZPARM LIMIT
QDST#7   DS    F          #CURRENT INACTIVE DBATS
QDST#8   DS    F          MAXIMUM # INACTIVE THRDS
QDST#9   DS    F          #CURRENT ACTIVE DBATS
QDST#10  DS    F          MAXIMUM # ACTIVE DBATS
QDST#11  DS    F          MAXIMUM # ACTIVE AND INACTIVE DBATS
*
SYSSSID  DS    F          DB2 SUBSYSTEM ID
**********************************************************************
*
*     PROGRAM NAME - SYSSTATS
*
*     FUNCTION     - RETRIEVE DB2 SYSTEM SERVICES ADDRESS SPACE
*                    STATISTICS VIA THE INSTRUMENTATION FACILITY
*                    INTERFACE
*
*     INPUT        - UPON ENTRY R1 POINTS AT THE FOLLOWING PARMS
*                    P1 - $PARM1   DSECT
*                         EYEBALL  DC    CL8'WORKAREA'
*                         WORKAREA DS    512F
*
*     REGISTERS    - R1 --> CALLER PARMLIST
*                    R3 --> WORKAREA SUPPLIED BY CALLER
*                    R4 --> IFCA
*                    R5 =   RETURN CODE FROM IFCA
*                    R6     WORK
*                    R7        REGISTERS
*                    R8              FOR
*                    R9                 MOVING DATA
*                    R13    BASE REGISTER AND SAVE AREA POINTER
*
*     OUTPUT       - WORKAREA WILL BE FILLED IN WITH DSNMSTR STATS
*
*     MACROS       - NONE
*
*     RETURN CODES - 0 - STATS WERE SUCCESSFULLY RETRIEVED
*                    4 - STATS WEREN'T SUCCESSFULLY RETRIEVED
*
*     (1)  GET INPUT PARAMETERS
*          SET UP IFCA
*
*     (2)  CALL DSNWLI TO GET SYSTEM STATISTICS
*
*     (3)  IF  CALL IS UNSUCCESSFUL
*
*     (4)      BRANCH TO NOGOOD TO SET RC=4
*
*          ELSE
*
*     (5)      ADJUST AND MOVE TIMESTAMP
*
*     (6)      MOVE ADDRESS SPACE TIMERS
*
*     (7)      MOVE SSC STUFF
*
*     (8)      MOVE COMMAND COUNTERS
*
*     (9)      MOVE CHECKPOINT COUNT AND LOG RBA
*
*     (10)     MOVE LOG STATISTICS
*
*          ENDIF
*
*     (11) EXIT
*
**********************************************************************
SYSSTATS  CSECT
          STM   R14,R12,12(R13)
          BAL   R14,80(R15)
          DC    18F'-1'
          ST    R13,4(R14)
          ST    R14,8(R13)
          LR    R13,R14
          USING SYSSTATS+8,R13
*(1)
          L     R3,0(R1)             GET ADDRESS OF WORKAREA
          USING $PARM1,R3            SET UP ADDRESSABILITY
          XC    QWSAPRC1(88),QWSAPRC1
          XC    Q3ST#1(60),Q3ST#1
          XC    Q9ST#1(136),Q9ST#1
          XC    QWSD#1(72),QWSD#1
          XC    QJST#1(76),QJST#1
          XC    QLST1#1(172),QLST1#1
          XC    QLST1#2(172),QLST1#2
          XC    QLST1#3(172),QLST1#3
          XC    QLST1#4(172),QLST1#4
          MVC   QLST1#1,=CL16' '
          MVC   QLST2#1,=CL16' '
          MVC   QLST3#1,=CL16' '
          MVC   QLST4#1,=CL16' '
          L     R4,=A(IFCAWORK)      GET ADDRESS OF IFCA WORKAREA
          USING IFCA,R4              SET UP ADDRESSABILITY
*(2)
          OI    PARMEND,X'80'        SET END OF PARMLIST
          L     R1,=A(PARMLIST)      POINT R1 AT PARMLIST
          L     R15,=V(DSNWLI)       POINT R15 AT DB2 INTERFACE
          BALR  R14,R15              GO GET STATS
*(3)
          L     R5,IFCARC1           GET RETURN CODE
          LTR   R5,R5                DID IT WORK?
*(4)
          BNZ   NOGOOD               BRANCH AROUND IF IT DIDN'T
*(5)
          LA    R11,RETNSPOT         R11--> START OF RECORD
          LA    R6,RETNSPOT+4        R6--> QWS0
          USING QWS0,R6              ESTABLISH ADDRESSABILITY
          L     R7,QWS00PSO          GET OFFSET TO PRODUCT SECTION
          LA    R8,0(R11,R7)         R8--> PRODUCT SECTION
          USING QWHS,R8              ESTABLISH ADDRESSABILITY
          MVC   SYSSSID(4),QWHSSSID  MOVE DB2 SUBSYSTEM ID
          LM    R0,R1,QWHSSTCK       GET TIMESTAMP
          SRDL  R0,4                 DIVIDE BY 16 TO AVOID 0C9
          STM   R0,R1,TIMESTMP       STORE IN CALLER'S AREA
*(6)
          L     R7,QWS00R1O          GET OFFSET TO QWSA
          LH    R9,QWS00R1L          GET LENGTH OF EACH ENTRY
          LH    R10,QWS00R1N         GET NUMBER OF ENTRIES
          LA    R8,0(R11,R7)         R8 --> QWSA
          USING QWSA,R8              ESTABLISH ADDRESSABILITY
          MVC   QWSAPRC1(22),QWSAPROC MOVE FIRST SET
          BCTR  R10,0                DECREMENT
          LA    R8,0(R8,R9)          BUMP TO NEXT ENTRY
          MVC   QWSAPRC2(22),QWSAPROC MOVE SECOND SET
          BCTR  R10,0                DECREMENT
          LA    R8,0(R8,R9)          BUMP TO LAST ENTRY
          MVC   QWSAPRC3(22),QWSAPROC MOVE LAST SET
          BCTR  R10,0                DECREMENT
          LTR   R10,R10              DDF OUT THERE?
          BZ    STEP7                GET OUT IF NOT
          LA    R8,0(R8,R9)          BUMP TO LAST ENTRY
          MVC   QWSAPRC4(22),QWSAPROC MOVE LAST SET
*(7)
STEP7     L     R7,QWS00R4O          GET OFFSET TO Q3ST
          LA    R8,0(R11,R7)         R8--> Q3ST
          USING Q3ST,R8              ESTABLISH ADDRESSABILITY
          MVC   Q3ST#1(36),Q3STIDEN  MOVE FIRST BUNCH
          MVC   Q3ST#10(24),Q3STINDT MOVE SECOND BUNCH
*(8)
          L     R7,QWS00R5O          GET OFFSET TO Q9ST
          LA    R8,0(R11,R7)         R8--> Q9ST
          USING DSNDQ9ST,R8          ESTABLISH ADDRESSABILITY
          MVC   Q9ST#1(116),Q9ST     MOVE COUNTERS
          MVC   Q9ST#30(20),Q9STCTRT MOVE MORE COUNTERS
*(9)
          L     R7,QWS00R6O          GET OFFSET TO QWSD
          LA    R8,0(R11,R7)         R8--> QWSD
          USING QWSD,R8              ESTABLISH ADDRESSABILITY
          MVC   QWSD#1(4),QWSDCKPT   MOVE CHECKPOINT COUNT
          UNPK  LOGRBA(9),QWSDLR(5)  GET FIRST HALF OF RBA
          UNPK  LOGRBA+8(9),QWSDLR+4(5) GET LAST HALF OF RBA
          TR    LOGRBA(16),TRANTAB   FIX UP 'ABCDEF'
          MVC   QWSD#2(16),LOGRBA    MOVE RBA
          MVC   QWSD#3(52),QWSDSCA   MOVE IFI AND DC STUFF
QLSTSPOT  L     R7,QWS00RAO          GET OFFSET TO DDF STUFF
          LH    R9,QWS00RAL          GET LENGTH OF ENTRIES
          LH    R10,QWS00RAN         GET NUMBER OF ENTRIES
          LTR   R7,R7                ANYTHING THERE?
          BZ    QJSTSPOT             TAKE A HIKE IF NOT
          LA    R8,0(R11,R7)         R8-->QLST
          USING QLST,R8              ESTABLISH ADDRESSABILITY
          MVC   QLST1#1(172),QLSTLOCN MOVE STUFF
          BCTR  R10,R0               DECREMENT
          LTR   R10,R10              ANY MORE?
          BZ    QJSTSPOT             GET OUT IF NOT
          LA    R8,0(R8,R9)          BUMP TO NEXT ENTRY
          MVC   QLST2#1(172),QLSTLOCN MOVE STUFF
          BCTR  R10,R0               DECREMENT
          LTR   R10,R10              ANY MORE?
          BZ    QJSTSPOT             GET OUT IF NOT
          LA    R8,0(R8,R9)          BUMP TO NEXT ENTRY
          MVC   QLST3#1(172),QLSTLOCN MOVE STUFF
          BCTR  R10,R0               DECREMENT
          LTR   R10,R10              ANY MORE?
          BZ    QJSTSPOT             GET OUT IF NOT
          LA    R8,0(R8,R9)          BUMP TO NEXT ENTRY
          MVC   QLST4#1(172),QLSTLOCN MOVE STUFF
*(10)
QJSTSPOT  L     R7,QWS00RBO          GET OFFSET TO QJST
          LA    R8,0(R11,R7)         R8--> QJST
          USING QJST,R8              ESTABLISH ADDRESSABILITY
          MVC   QJST#1(56),QJSTWRW   MOVE LOG INFO
QDSTSPOT  L     R7,QWS00RCO          GET OFFSET TO DDF
          LTR   R7,R7                ANYTHING THERE
          BZ    EXIT00               GET OUT IF NOT
          LA    R8,0(R11,R7)         R8--> QDST
          USING QDST,R8
          MVC   QDST#1(44),QDSTQDBT
EXIT00    SR    R15,R15              SET RC=0
          OPEN  (SNAPDCB,(OUTPUT))   OPEN SNAP FILE
          LA    R9,RETNAREA
          LA    R10,2052(R9)
 SNAP  DCB=SNAPDCB,STORAGE=((R9),(R10)),PDATA=REGS
          CLOSE SNAPDCB
          B     EXIT                 LEAVE
*
NOGOOD    LA    R15,4                SET RC=4
          OPEN  (SNAPDCB,(OUTPUT))   OPEN SNAP FILE
          LA    R9,RETNAREA
          LA    R10,2052(R9)
 SNAP  DCB=SNAPDCB,STORAGE=((R9),(R10)),PDATA=REGS
          CLOSE SNAPDCB
*
*(11)
EXIT      L     R13,4(R13)           RESTORE SAVEAREA POINTER
          L     R14,12(R13)          RESTORE RETURN ADDRESS
          LM    R0,R12,20(R13)       DON'T RESTORE RETURN CODE
          BR    R14
          LTORG
IFCIDS    DC    X'00060000'
          DC    X'0001'
IFCAWORK  DS    0CL180
          DC    X'00B40000'
          DC    C'IFCA'
          DC    C'MINE'
          DC    42F'0'
READS     DC    CL8'READS   '
PARMLIST  DC    A(READS)
          DC    A(IFCAWORK)
          DC    A(RETNAREA)
PARMEND   DC    A(IFCIDS)
LOGRBA    DS    CL20
TRANTAB   DC    240X'00'
          DC    C'0123456789ABCDEF'
SNAPDCB   DCB DSORG=PS,RECFM=VBA,MACRF=(W),BLKSIZE=882,LRECL=125,      X
               DDNAME=SNAPOUT
          DC    CL80'THIS IS THE BEGINNING OF RETNAREA SYSTEM STATS'
          DC    CL80'COPYRIGHT 2001 DAVID J YOUNG'
RETNAREA  DS    0CL4100
          DC    F'4100'
RETNSPOT  DS    F                    DSNDWIW HEADER
          DS    1023F                QWS0
          END
